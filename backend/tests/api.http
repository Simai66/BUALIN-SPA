# Thai Spa API Test Collection
# ใช้กับ VS Code REST Client Extension หรือ IntelliJ HTTP Client

### Variables
@baseURL = http://localhost:5000
@frontendURL = http://localhost:3001
@adminEmail = admin@thaispa.com
@adminPassword = Admin@123
@userEmail = user@example.com
@userPassword = User@123

###############################################################################
# 1. HEALTH & READINESS CHECKS
###############################################################################

### Health Check
GET {{baseURL}}/health HTTP/1.1

### Check CORS Headers
GET {{baseURL}}/health HTTP/1.1
Origin: {{frontendURL}}

###############################################################################
# 2. AUTH - REGISTRATION & VERIFICATION
###############################################################################

### Register New User
POST {{baseURL}}/api/auth/register HTTP/1.1
Content-Type: application/json

{
  "full_name": "Test User",
  "email": "testuser+{{$timestamp}}@example.com",
  "phone": "0812345678",
  "password": "Test@123"
}

### Verify Email (replace token and email from registration email)
GET {{baseURL}}/api/auth/verify?token=YOUR_TOKEN_HERE&email=testuser@example.com HTTP/1.1

###############################################################################
# 3. AUTH - LOGIN
###############################################################################

### Login as User
# @name loginUser
POST {{baseURL}}/api/auth/login HTTP/1.1
Content-Type: application/json

{
  "email": "{{userEmail}}",
  "password": "{{userPassword}}"
}

### Login as Admin
# @name loginAdmin
POST {{baseURL}}/api/auth/login HTTP/1.1
Content-Type: application/json

{
  "email": "{{adminEmail}}",
  "password": "{{adminPassword}}"
}

### Get Current User Profile (requires login cookie)
GET {{baseURL}}/api/auth/me HTTP/1.1
Cookie: token=YOUR_JWT_TOKEN_HERE

### Logout
POST {{baseURL}}/api/auth/logout HTTP/1.1
Cookie: token=YOUR_JWT_TOKEN_HERE

###############################################################################
# 4. SERVICES & CATALOG
###############################################################################

### Get All Services
GET {{baseURL}}/api/services HTTP/1.1

### Get Single Service
GET {{baseURL}}/api/services/1 HTTP/1.1

### Get All Therapists
GET {{baseURL}}/api/therapists HTTP/1.1

### Get Single Therapist
GET {{baseURL}}/api/therapists/1 HTTP/1.1

### Get All Promotions
GET {{baseURL}}/api/promotions HTTP/1.1

### Get Gallery Items
GET {{baseURL}}/api/gallery HTTP/1.1

###############################################################################
# 5. BOOKING SLOTS
###############################################################################

### Get Available Time Slots
GET {{baseURL}}/api/booking/slots?service_id=1&therapist_id=1&date=2025-01-15 HTTP/1.1

###############################################################################
# 6. BOOKINGS (Requires Authentication)
###############################################################################

### Get User's Bookings
GET {{baseURL}}/api/bookings HTTP/1.1
Cookie: token=YOUR_JWT_TOKEN_HERE

### Create New Booking
# @name createBooking
POST {{baseURL}}/api/bookings HTTP/1.1
Content-Type: application/json
Cookie: token=YOUR_JWT_TOKEN_HERE

{
  "service_id": 1,
  "therapist_id": 1,
  "booking_datetime": "2025-01-15T10:00:00.000Z"
}

### Update Booking Status (Admin Only)
PUT {{baseURL}}/api/bookings/1/status HTTP/1.1
Content-Type: application/json
Cookie: token=YOUR_ADMIN_JWT_TOKEN_HERE

{
  "status": "confirmed"
}

###############################################################################
# 7. ADMIN - DASHBOARD & REPORTS
###############################################################################

### Get Admin Dashboard (with date filters)
GET {{baseURL}}/api/admin/dashboard?start_date=2025-01-01&end_date=2025-01-31 HTTP/1.1
Cookie: token=YOUR_ADMIN_JWT_TOKEN_HERE

### Export PDF Report
GET {{baseURL}}/api/admin/export/pdf?start_date=2025-01-01&end_date=2025-01-31 HTTP/1.1
Cookie: token=YOUR_ADMIN_JWT_TOKEN_HERE

### Export Excel Report
GET {{baseURL}}/api/admin/export/excel?start_date=2025-01-01&end_date=2025-01-31 HTTP/1.1
Cookie: token=YOUR_ADMIN_JWT_TOKEN_HERE

###############################################################################
# 8. ADMIN - CRUD OPERATIONS
###############################################################################

### Create Service (Admin)
POST {{baseURL}}/api/services HTTP/1.1
Content-Type: application/json
Cookie: token=YOUR_ADMIN_JWT_TOKEN_HERE

{
  "name": "Test Service",
  "description": "Test Description",
  "duration_minutes": 60,
  "base_price": 500
}

### Update Service (Admin)
PUT {{baseURL}}/api/services/1 HTTP/1.1
Content-Type: application/json
Cookie: token=YOUR_ADMIN_JWT_TOKEN_HERE

{
  "name": "Updated Service Name",
  "base_price": 600
}

### Delete Service (Admin)
DELETE {{baseURL}}/api/services/1 HTTP/1.1
Cookie: token=YOUR_ADMIN_JWT_TOKEN_HERE

### Create Therapist (Admin)
POST {{baseURL}}/api/therapists HTTP/1.1
Content-Type: application/json
Cookie: token=YOUR_ADMIN_JWT_TOKEN_HERE

{
  "name": "Test Therapist",
  "specialty": "Traditional Thai Massage",
  "bio": "Expert with 10 years experience"
}

### Update Therapist (Admin)
PUT {{baseURL}}/api/therapists/1 HTTP/1.1
Content-Type: application/json
Cookie: token=YOUR_ADMIN_JWT_TOKEN_HERE

{
  "name": "Updated Name",
  "is_active": false
}

###############################################################################
# 9. RATE LIMITING TEST
###############################################################################

### Test Rate Limit (repeat 15 times quickly)
POST {{baseURL}}/api/auth/login HTTP/1.1
Content-Type: application/json

{
  "email": "wrong@email.com",
  "password": "wrongpassword"
}

###############################################################################
# 10. ERROR SCENARIOS
###############################################################################

### Invalid Login
POST {{baseURL}}/api/auth/login HTTP/1.1
Content-Type: application/json

{
  "email": "invalid@email.com",
  "password": "wrong"
}

### Unauthorized Access (no cookie)
GET {{baseURL}}/api/bookings HTTP/1.1

### Forbidden Access (user trying admin endpoint)
GET {{baseURL}}/api/admin/dashboard HTTP/1.1
Cookie: token=USER_JWT_TOKEN_HERE

### Not Found
GET {{baseURL}}/api/nonexistent HTTP/1.1

### Invalid Booking (missing fields)
POST {{baseURL}}/api/bookings HTTP/1.1
Content-Type: application/json
Cookie: token=YOUR_JWT_TOKEN_HERE

{
  "service_id": 1
}
